\section{Modes}


Any relation comes with a multitude of \emph{modes}, or directions.
The mode, among other things, specifies which arguments of the relation are input, and which values are to be computed.
In some systems, such as \mercury, modes also specify the determinism of a relation: whether or not it is supposed to compute one or many values.
There are many other different types of determinism, one can \todo{read more about this here}.

\begin{figure}[!t]
  \centering
  \begin{minipage}{0.28\textwidth}
    \begin{lstlisting}[label={add}, caption={Addition relation}, captionpos=b, frame=tb]
let rec add$^o$ x y z = conde [
  (x === zero /\ y === z);
  (fresh (x' z')
    (x === succ x' /\
     z === succ z' /\
     add$^o$ x' y z') ) ]
    \end{lstlisting}
  \end{minipage}
\end{figure}

A relation with a specified mode can be viewed as a function which maps its bound variables into its free variables.
Consider a relation \lstinline{add$^o$ x y z} in Listing~\ref{add} with the mode \lstinline{(in, in, out) is det}.
This mode means that the arguments \x and \y are known (are input), the value of \z is computed, and there must be exactly one value of \z for every distinct pair of values of \x and \y.
This mode corresponds to the addition.
The mode \lstinline{(out, out, in) is nondet} means that the value of \z is known, the values of \x and \y are computed.
We use \lstinline{nondet} here, since there may be a multitude of possible pairs of \x and \y which sum up to a given value \z.
Notice that at least one such pair exist for any value of \z, but we do not explicitly specify it.

Modes cannot be computed exactly, only over-approximated \todo{find a citation for some Mercury paper}.
Mercury allows to only specify modes for top-level predicates and functions, and the uses abstract interpretation to inference other modes.
It is not unusual to have several modes for a single predicate.
A predicate with a given mode may directly or indirectly use the same predicate with different modes.
In this case, several functions are generated for each mode of the predicate.
